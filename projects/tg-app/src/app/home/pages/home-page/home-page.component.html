<div class="d-flex flex-column">
  <div class="d-flex flex-column">
    <div class="header d-flex justify-content-end">
      <div>
        <tga-portfolio-selection></tga-portfolio-selection>
      </div>
    </div>

    <div class="portfolio-summary">
      <tga-portfolio-evaluation></tga-portfolio-evaluation>
    </div>

    <div class="ideas">
      Инвестиционные идеи
      <a
        nz-button
        nzSize="small"
        nzType="link"
        (click)="changeDrawerVisibility(true, selectedItemType.InvestingIdeas)"
      >
        Ещё
      </a>
    </div>
  </div>

  <div class="d-flex flex-column">
    <div class="links">
      Ссылки
    </div>

    <div class="portfolio-details d-flex flex-column">
      <nz-collapse nzExpandIconPosition="end">
        <nz-collapse-panel nzHeader="Позиции">
          <tga-positions-list></tga-positions-list>
        </nz-collapse-panel>

        <nz-collapse-panel nzHeader="Сделки">
          <tga-trades-list></tga-trades-list>
        </nz-collapse-panel>

        <nz-collapse-panel nzHeader="Заявки">
          <tga-orders-list (selectItem)="changeDrawerVisibility(true, selectedItemType.Order, $event)"></tga-orders-list>
        </nz-collapse-panel>
      </nz-collapse>
    </div>
  </div>
</div>

@if (drawerContext$ | async; as drawerContext) {
  <nz-drawer
    [nzTitle]="drawerTitle"
    nzPlacement="bottom"
    nzHeight="100%"
    [nzClosable]="false"
    [nzVisible]="drawerContext.isVisible"
    (nzOnClose)="changeDrawerVisibility(false)"
  >
    <ng-container *nzDrawerContent>
      @switch (drawerContext.itemType) {
        @case (SelectedItemType.InvestingIdeas) {
          <tga-investment-ideas
            (onBack)="changeDrawerVisibility(false)"
          ></tga-investment-ideas>
        }
        @case (SelectedItemType.Order) {
          <tga-order-item
            [order]="drawerContext.data"
            (onBack)="changeDrawerVisibility(false)"
          ></tga-order-item>
        }
      }
    </ng-container>
  </nz-drawer>

  <ng-template #drawerTitle>
    <div class="d-flex align-items-center">
      @if (!isBackButtonAvailable) {
        <button
          nz-button
          nzType="text"
          class="mr-15"
          (click)="changeDrawerVisibility(false)"
        >
          <span nz-icon nzType="left" nzTheme="outline"></span>
        </button>
      }

      @switch (drawerContext.itemType) {
        @case (SelectedItemType.InvestingIdeas) {
          <h3 class="mb-0">Инвестиционные идеи</h3>
        }
        @case (SelectedItemType.Order) {
          <h3 class="mb-0">Заявка №{{drawerContext.data.id}}</h3>
        }
      }
    </div>
  </ng-template>
}
